version: '3'
services:
  cassandra:
    image: cassandra:4.0.12
    hostname: cassandra
    container_name: cassandra
    extra_hosts:
      - "region1:34.173.176.232"
      - "region2:34.45.179.107"
    ports:
      - "9042:9042"
      - "7000:7000"
    environment:
      - CASSANDRA_RPC_ADDRESS=0.0.0.0 #IP address that Cassandra uses to listen for client connections. Clients (like an application using a Cassandra driver)
      #      - CASSANDRA_LISTEN_ADDRESS=region1 #It should be an IP address that is reachable by all other nodes within the cluster.
      - CASSANDRA_SEEDS=region1,region2 #A new node contacts one of the seed nodes to learn about the topology of the entire cluster. Seed nodes are not special once the cluster is running, but they are crucial for a new node to join the cluster
      - CASSANDRA_BROADCAST_ADDRESS=region1 #This is the IP address that a Cassandra node advertises to other nodes in the cluster. Other nodes use this address to connect to this node for gossip and data exchange
      - CASSANDRA_ENDPOINT_SNITCH=GossipingPropertyFileSnitch
      # Performance optimizations
      - CASSANDRA_CONCURRENT_WRITES=128
      - CASSANDRA_CONCURRENT_READS=128
      - CASSANDRA_WRITE_REQUEST_TIMEOUT_IN_MS=1000
      - CASSANDRA_READ_REQUEST_TIMEOUT_IN_MS=2000
      - CASSANDRA_COMMITLOG_SYNC=batch
      - CASSANDRA_COMMITLOG_SYNC_BATCH_WINDOW_IN_MS=2
      - CASSANDRA_INTERNODE_COMPRESSION=dc
      - CASSANDRA_DC=region1
      - CASSANDRA_RACK=rack1
      - JVM_OPTS=-Xmx2G -Xms2G
    networks:
      - local

networks:
  local:
    driver: bridge